 <template>
  <div class="hello">
    <div
      id="del-area"
      style="position: relative;width:100%;height:50px;background-color:red"
      @drop="data.myTable.dragDel($event)"
      @dragover='data.myTable.dragOver($event)'
    > </div>
    <ul>
      <li
        v-for='item in list'
        :key='item.title'
        draggable='true'
        v-on:dragstart='dragStart($event,item)'
      >
        {{item.title}}
      </li>
    </ul>
    <h2 @dblclick="data.myTable.ondbClick(data.myTable)">
      <div v-if="data.myTable.showType == 0">{{data.myTable.tableName}}
      </div>
      <div v-if="data.myTable.showType == 1">
        <input
          @mouseover="data.myTable.getfocus($event)"
          @blur="data.myTable.inputOnBlur(data.myTable)"
          v-model="data.myTable.tableName"
        />
      </div>
    </h2>
    <div class="table-div-0">
      <!-- 左上角填充 -->
      <div class="fix-top-left-table">
        <table
          v-if='data.myTable'
          class='my-table left-table'
          cellspacing="0"
          cellpadding="0"
          border="0"
        >
          <thead>
            <tr>
              <th class="rowNumber">
                <div></div>
              </th>
            </tr>
            <tr
              v-for='(tr, i) in data.myTable.tableHeadTop'
              :key='tr+i'
            >
              <th
                class="rowNumber"
                @dragover='data.myTable.dragOver($event)'
                @drop='data.myTable.drop($event)'
              >
                <div v-bind:style="[data.myTable.rowNumber[i].cell.style,data.myTable.rowNumber[i].style]">{{data.myTable.rowNumber[i].cell.content}}</div>
              </th>
            </tr>
          </thead>
        </table>
      </div>
      <!-- 左侧固定表头 -->
      <div
        class="fix-left-table"
        :scrollTop.prop="data.myTable.style.scrollTop"
      >
        <table
          v-if='data.myTable'
          class='my-table left-table'
        >
          <thead>
            <tr>
              <th class="rowNumber">
                <div></div>
              </th>
            </tr>
            <tr
              v-for='(th, i) in data.myTable.rowNumber'
              :key='"row"+i'
            >
              <th
                class="rowNumber"
                tabindex="0"
                @mousedown="data.myTable.onMouseDown($event,th)"
                @mouseout="data.myTable.onMouseOut($event,th)"
                @mousemove="data.myTable.onMouseMove($event,th)"
                @keydown="data.myTable.onKeyDown($event)"
                @keyup="data.myTable.onKeyUp($event)"
                @blur="data.myTable.colRowIndexOnBlur(th)"
                @click="data.myTable.onTrClick($event,th)"
                @dragover='data.myTable.dragOver($event,th)'
                @drop='data.myTable.drop($event,th)'
              >
                <div v-bind:style="[th.cell.style,th.style]">{{th.cell.content}}</div>
              </th>
            </tr>
          </thead>
        </table>
      </div>
      <!-- 上测固定表头 -->
      <div
        class="fix-top-table"
        :scrollLeft.prop="data.myTable.style.scrollLeft"
      >
        <table
          v-if='data.myTable'
          class='my-table left-table'
          cellspacing="0"
          cellpadding="0"
          border="0"
        >
          <thead>
            <tr>
              <th class="rowNumber">
                <div></div>
              </th>
              <th
                class="colNumber"
                v-bind:style="th.style"
                @mousedown="data.myTable.onMouseDown($event,th)"
                @mouseout="data.myTable.onMouseOut($event,th)"
                @mousemove="data.myTable.onMouseMove($event,th)"
                @keydown="data.myTable.onKeyDown($event)"
                @keyup="data.myTable.onKeyUp($event)"
                tabindex="1"
                @blur="data.myTable.colRowIndexOnBlur(th)"
                @click="data.myTable.onTrClick($event,th)"
                v-for='(th,i) in data.myTable.colNumber'
                :key='"col"+i'
                v-on:dragover='data.myTable.dragOver($event,th)'
                @drop='data.myTable.drop($event,th)'
              >
                <div v-bind:style="[th.cell.style,th.style]">{{th.cell.content}}</div>
              </th>
            </tr>
            <tr
              v-for='(tr, i) in data.myTable.tableHeadTop'
              :key='"tr"+i'
            >
              <th class="rowNumber">
                <div v-bind:style="[data.myTable.rowNumber[i].cell.style,data.myTable.rowNumber[i].style]"></div>
              </th>
              <th
                class="colNumber"
                v-if='i===0&&data.myTable.tableHeadLeft[0]'
                :colspan="data.myTable.theadLeftEntity.side2"
                :rowspan="data.myTable.tableHeadTop.length"
              >
                <div></div>
              </th>
              <!-- 上测固定表头 -->
              <th
                v-bind:style="th.style"
                class='top-th'
                v-for='(th, j) in tr'
                :key='th.name+j'
                tabindex="1"
                @keydown="data.myTable.onKeyDown($event)"
                @keyup="data.myTable.onKeyUp($event)"
                @blur="data.myTable.onThOnBlur(th)"
                @click="data.myTable.onThClick(th)"
                @dblclick="data.myTable.ondbClick(th)"
                v-bind:class="{selected:th.selected}"
                draggable='true'
                @dragstart="data.myTable.dragStart($event,th)"
                @dragover='data.myTable.dragOver($event,th)'
                @drop='data.myTable.drop($event,th)'
                @dragleave="data.myTable.theadTopEntity.dragLeave($event)"
                :colspan="th.cell.span1"
                :rowspan="th.cell.span2"
              >
                <div
                  v-bind:style="[th.cell.style,th.style]"
                  v-if="th.showType == 0"
                >{{th.cell.content}}
                </div>
                <div v-if="th.showType == 1">
                  <input
                    @mouseover="data.myTable.getfocus($event)"
                    @blur="data.myTable.inputOnBlur(th,true)"
                    v-model="th.cell.content"
                  />
                </div>
              </th>
            </tr>
          </thead>
        </table>
      </div>
      <!-- 主表 -->
      <div
        class='main-div'
        :scrollTop="data.myTable.style.scrollTop"
        @scroll="data.myTable.onScroll($event)"
        id='div1'
      >
        <table
          v-if='data.myTable'
          class='my-table'
          cellspacing="0"
          cellpadding="0"
          border="0"
        >
          <thead>
            <tr>
              <th class="rowNumber">
                <div></div>
              </th>
              <th
                class="colNumber"
                v-for='(th,i) in data.myTable.colNumber'
                :key='"col"+i'
                v-on:dragover='data.myTable.dragOver($event,th)'
                v-on:drop='data.myTable.dropTopA_Z($event)'
              >
                <div v-bind:style="[th.cell.style,th.style]">{{th.cell.content}}</div>
              </th>
            </tr>
            <tr
              v-for='(tr, i) in data.myTable.tableHeadTop'
              :key='tr+i'
            >
              <th class="rowNumber"></th>
              <th
                class="colNumber"
                v-if='i===0&&data.myTable.tableHeadLeft[0]'
                :colspan="data.myTable.theadLeftEntity.side2"
                :rowspan="data.myTable.tableHeadTop.length"
              >
                <div>test</div>
              </th>
              <th
                v-for='(th, i) in tr'
                :key='th.name+i'
                :colspan="th.cell.span1"
                :rowspan="th.cell.span2"
              >
                <div v-bind:style="[th.cell.style,th.style]"> </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              v-for='(tr, i) in data.myTable.tableBody'
              :key='tr+i'
            >
              <th class="rowNumber">
                <div></div>
              </th>
              <!-- 主表里左侧表头 -->
              <th
                tabindex="1"
                v-for="(th,j) in data.myTable.tableHeadLeft[i]"
                @keydown="data.myTable.onKeyDown($event)"
                @keyup="data.myTable.onKeyUp($event)"
                @blur="data.myTable.onThOnBlur(th)"
                @click="data.myTable.onThClick(th)"
                @dblclick="data.myTable.ondbClick(th)"
                v-bind:class="{selected:th.selected}"
                :key='th+j'
                draggable='true'
                @dragstart="data.myTable.dragStart($event,th)"
                @dragover='data.myTable.dragOver($event,th)'
                @drop='data.myTable.drop($event,th)'
                @dragleave="data.myTable.theadLeftEntity.dragLeave($event)"
                :colspan="th.cell.span2"
                :rowspan="th.cell.span1"
              >
                <div
                  v-bind:style="[th.cell.style,th.style]"
                  v-if="th.showType == 0"
                >
                  {{th.cell.content}}

                </div>
                <div
                  v-bind:style="[th.cell.style,th.style]"
                  v-if="th.showType == 1"
                >
                  <input
                    @mouseover="data.myTable.getfocus($event)"
                    @blur="data.myTable.inputOnBlur(th,true)"
                    v-model="th.cell.content"
                  />
                </div>
              </th>
              <!-- <td v-bind:class="{ rowSelected:  data.myTable.getIfRowSelect(i),colSelected:data.myTable.getIfColSelectByTd(j)}" v-for='(td, j) in tr' :key='1 + j'></td> -->
              <td
                tabindex="1"
                @paste="data.myTable.onpaste($event,td)"
                @dblclick="data.myTable.ondbClick(td)"
                v-for='(td, j) in tr'
                :key='1 + j'
              >
                <div
                  v-bind:style="[td.cell.style,td.style]"
                  v-if="td.showType == 0"
                >{{td.cell.content}}
                </div>
                <div
                  v-bind:style="[td.cell.style,td.style]"
                  v-if="td.showType == 1"
                >
                  <input
                    @input="th.cell.onInput()"
                    @mouseover="data.myTable.getfocus($event)"
                    @blur="data.myTable.inputOnBlur(td,true)"
                    v-model="td.cell.content"
                  />
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
    <button @click="add()">add</button>
    <button @click="data.myTable.addParent()">添爹</button>
    <button @click="data.myTable.merge()">合并单元格</button>
    <button @click="data.myTable.disMerge()">拆分单元格</button>
    <button @click="data.myTable.mutiPaste($event)">批量粘贴</button>
    <button @click="data.myTable.addNewRow($event)">添加行</button>
    <button @click="data.myTable.addNewCol($event)">添加列</button>
  </div>
</template>

<script lang="ts">
  import { Component, Prop, Vue } from "vue-property-decorator";
  import { DragTable } from "../../packages/drag-table/dragTable";
  import { DragStartData } from "../../packages/drag-table/interface/DragStartData";
  @Component
  export default class MyTable extends Vue {
    public a = 0;
    private list = [
      { title: "科室" },
      { title: "门诊量" },
      { title: "地方" },
      { title: "我的名字特别长" }
    ];
    private data = {
      myTable: null
    };
    private methods = {};
    private dragTable: DragTable = new DragTable();
    private myTable: any;
    private mounted() {}

    private created() {
      this.data.myTable = this.dragTable.getTable("");
      this.data.myTable.initTbody(10, 15);
      //  this.data.myTable.tbodyEntity.initData(10,10);
    }
    private add() {
      console.log("add");
    }

    /**
     * 粘贴事件
     *
     * @param {*} e
     * @param {*} container
     * @memberof BaseTable
     */
    private onpaste(e: any, container: any) {
      console.log("pastedText");
    }
    private dragStart(ev: any, item: any) {
      this.a++;
      const dragStartData: DragStartData = {
        operationType: "add",
        containerData: {
          cell: {
            content: item.title + this.a,
            data: item
          }
        }
      } as DragStartData;
      console.log(dragStartData);
      ev.dataTransfer.setData("dragStartData", JSON.stringify(dragStartData));
    }
  }
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
  @import "../../packages/drag-table/css/table.css"; /*引入公共样式*/
</style>
